<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toastmasters Speech Timer Pro</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-green: rgba(34, 197, 94, 1);
            --color-yellow: rgba(234, 179, 8, 1);
            --color-red: rgba(220, 38, 38, 1);
            --color-red-bright: rgba(255, 68, 68, 1);
            --font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 20px;
            --font-size-2xl: 24px;
            --font-size-3xl: 32px;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --space-32: 32px;
            --space-40: 40px;
            --radius-base: 10px;
            --radius-xl: 16px;
            --duration-normal: 300ms;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            font-family: var(--font-family-base);
            background: #000;
        }

        body {
            min-height: 100vh;
            color: var(--color-white);
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            /* Enable vertical scroll when content overflows */
            overflow-y: auto;
        }

        .main-scroll-wrapper {
            /* Full width, min height 100vh, flex col */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            width: 100vw;
            padding-bottom: var(--space-40);
        }

        /* --- COLOR STAGES AND ANIMATIONS --- */
        body.stage-black {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            transition: background 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        body.stage-green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transition: background 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        body.stage-yellow {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            transition: background 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        body.stage-red {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            transition: background 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        body.stage-complete {
            animation: flash-complete 0.5s ease-in-out infinite;
            transition: none;
        }

        @keyframes flash-complete {
            0%, 100% {
                background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            }
            50% {
                background: linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%);
            }
        }

        /* --- CONTAINER --- */
        .container {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: var(--space-32);
            align-items: center;
            opacity: 1;
            transition: opacity 0.3s ease;
            visibility: visible;
            margin: var(--space-24) auto;
        }

        .container.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        /* HEADER */
        .header {
            text-align: center;
            margin-top: var(--space-24);
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-size: var(--font-size-3xl);
            font-weight: 800;
            margin-bottom: var(--space-12);
            background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 10px rgba(255, 255, 255, 0.1);
        }

        .stage-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--space-12);
            background: rgba(255, 255, 255, 0.12);
            padding: var(--space-14) var(--space-24);
            border-radius: 50px;
            font-size: var(--font-size-lg);
            font-weight: 700;
            backdrop-filter: blur(20px);
            border: 1.5px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .stage-dot {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            animation: pulse-dot 2s ease-in-out infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.3); }
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: var(--space-20);
            width: 100%;
            background: rgba(0, 0, 0, 0.25);
            padding: var(--space-32);
            border-radius: var(--radius-xl);
            backdrop-filter: blur(30px);
            border: 1.5px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-10);
        }

        .control-group label {
            font-size: var(--font-size-base);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #e0e0e0;
        }

        .control-group select,
        .control-group input {
            padding: var(--space-14) var(--space-18);
            border: 1.5px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-base);
            background: rgba(255, 255, 255, 0.08);
            color: var(--color-white);
            font-size: var(--font-size-base);
            font-family: var(--font-family-base);
            font-weight: 500;
            transition: all var(--duration-normal);
            backdrop-filter: blur(8px);
        }
        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.15);
        }

        .custom-time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-16);
        }

        .custom-time-inputs input {
            text-align: center;
            font-size: var(--font-size-xl);
            font-weight: 700;
        }

        .timer-display {
            font-size: clamp(60px, 18vw, 100px);
            font-weight: 900;
            text-align: center;
            font-family: 'Monaco', 'Courier New', monospace;
            letter-spacing: 0.08em;
            text-shadow: 0 8px 30px rgba(0, 0, 0, 0.8);
            min-height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.4);
            border-radius: var(--radius-xl);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.15);
            padding: var(--space-32);
            box-shadow: inset 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.8s ease-out 0.1s both;
        }

        .timer-display.pulse {
            animation: pulse-timer 0.6s ease-in-out infinite;
        }

        @keyframes pulse-timer {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: var(--space-12);
            width: 100%;
        }

        .btn--preset {
            padding: var(--space-12) var(--space-14);
            background: rgba(255, 255, 255, 0.08);
            color: var(--color-white);
            border: 1.5px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-base);
            font-size: var(--font-size-sm);
            font-weight: 700;
            cursor: pointer;
            transition: all var(--duration-normal);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn--preset:hover {
            background: rgba(255, 255, 255, 0.13);
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(255, 255, 255, 0.13);
            border-color: rgba(255, 255, 255, 0.3);
        }
        .btn--preset.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.6) 0%, rgba(139, 92, 246, 0.6) 100%);
            border-color: rgba(255, 255, 255, 0.7);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
            transform: scale(1.08);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: var(--space-12) 0;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.27);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.8), rgba(139, 92, 246, 0.8));
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.5);
        }

        /* <--- KEY: BUTTONS BAR ---!> */
        .button-group {
            width: 100%;
            display: flex;
            gap: var(--space-20);
            justify-content: stretch;
            margin-top: var(--space-28);
            margin-bottom: var(--space-8);
        }
        .btn {
            flex: 1 1;
            padding: var(--space-18) var(--space-20);
            border: none;
            border-radius: var(--radius-base);
            font-size: var(--font-size-lg);
            font-weight: 800;
            cursor: pointer;
            text-transform: uppercase;
            transition: all var(--duration-normal);
            border: 1.5px solid rgba(255,255,255,0.3);
            background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 100%);
            color: var(--color-white);
            box-shadow: 0 8px 20px rgba(0,0,0,0.23);
        }
        .btn:hover:not(:disabled) {
            background: linear-gradient(135deg, rgba(255,255,255,0.25) 0%, rgba(255, 255,255,0.13) 100%);
            transform: translateY(-4px);
            border-color: rgba(255,255,255,0.5);
        }
        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* --- FLOATING UI BUTTONS --- */
        .fullscreen-btn {
            position: fixed;
            top: var(--space-20);
            right: var(--space-20);
            width: 60px;
            height: 60px;
            border-radius: var(--radius-base);
            background: linear-gradient(135deg, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0.05) 100%);
            border: 1.5px solid rgba(255,255,255,0.3);
            color: var(--color-white);
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all var(--duration-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.29);
            backdrop-filter: blur(14px);
            z-index: 1001;
        }
        .fullscreen-btn:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0.12) 100%);
            transform: scale(1.12);
            box-shadow: 0 12px 35px rgba(255,255,255,0.15);
        }
        .fullscreen-btn.hidden { display: none !important; }

        /* --- FULLSCREEN OVERLAY --- */
        .fullscreen-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9000;
            padding: var(--space-20);
            gap: var(--space-40);
        }
        .fullscreen-overlay.active { display: flex !important;}

        .fullscreen-timer {
            font-size: clamp(80px, 50vw, 320px);
            font-weight: 900;
            text-align: center;
            font-family: 'Monaco', 'Courier New', monospace;
            letter-spacing: 0.1em;
            text-shadow: 0 15px 60px rgba(0,0,0,0.95);
            color: var(--color-white);
            animation: slideDown 0.6s ease-out;
        }

        .fullscreen-close-btn {
            position: fixed;
            top: var(--space-20); right: var(--space-20);
            width: 80px; height: 80px;
            border-radius: var(--radius-base);
            background: linear-gradient(135deg, rgba(255,255,255,0.17) 0%, rgba(255,255,255,0.07) 100%);
            border: 2px solid rgba(255,255,255,0.5);
            color: var(--color-white);
            font-size: 44px;
            font-weight: 800;
            cursor: pointer;
            transition: all var(--duration-normal);
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 12px 40px rgba(0,0,0,0.6);
            backdrop-filter: blur(19px);
            z-index: 9001;
        }
        .fullscreen-close-btn.show { display: flex !important;}
        .fullscreen-close-btn:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.26) 0%, rgba(255,255,255,0.12) 100%);
            transform: scale(1.13);
        }

        /* --- ABOUT MODAL --- */
        .about-btn {
            position: fixed;
            bottom: var(--space-20);
            right: var(--space-20);
            width: 60px; height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255,255,255,0.09) 0%, rgba(255,255,255,0.03) 100%);
            border: 2px solid rgba(255,255,255,0.23);
            color: var(--color-white);
            font-size: 28px; font-weight: 800;
            cursor: pointer; transition: all var(--duration-normal);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.32);
            backdrop-filter: blur(17px);
            z-index: 999;
        }
        .about-btn:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.14) 0%, rgba(255,255,255,0.06) 100%);
            transform: scale(1.12);
        }
        .about-btn.hidden { display: none !important;}
        .about-modal {
            position: fixed; bottom: 90px; right: var(--space-20);
            background: rgba(0,0,0,0.97);
            border: 2px solid rgba(255,255,255,0.17);
            border-radius: var(--radius-xl);
            padding: var(--space-28);
            min-width: 300px;
            backdrop-filter: blur(20px);
            color: var(--color-white);
            opacity: 0; visibility: hidden;
            transform: translateY(12px) scale(0.97);
            transition: all var(--duration-normal);
            z-index: 998;
        }
        .about-modal.show {
            opacity: 1; visibility: visible;
            transform: translateY(0) scale(1);
        }

        .about-modal h3 {
            font-size: var(--font-size-2xl);
            margin-bottom: var(--space-12); text-align: center;
            font-weight: 800;
        }
        .about-modal .divider {
            height: 1px; background: rgba(255,255,255,0.2); margin: var(--space-16) 0;
        }
        .about-modal .contact-item {
            display: flex; align-items: center; justify-content: center; gap: var(--space-10);
            margin: var(--space-12) 0; padding: var(--space-12) var(--space-16);
            background: rgba(255,255,255,0.08);
            border-radius: var(--radius-base); border: 1px solid rgba(255,255,255,0.13);
            transition: all var(--duration-normal);
        }
        .about-modal .contact-item:hover {
            background: rgba(255,255,255,0.13); border-color: rgba(255,255,255,0.25);}
        .about-modal .contact-item a {
            color: rgba(255,255,255,0.94);
            text-decoration: none;
            font-size: var(--font-size-sm); font-weight: 600; word-break: break-all;
        }
        .close-modal {
            position: absolute;
            top: var(--space-12); right: var(--space-12);
            width: 32px; height: 32px;
            background: rgba(255,255,255,0.17); border: none;
            border-radius: 50%; color: var(--color-white); font-size: 20px;
            cursor: pointer; transition: all 250ms;
            display: flex; align-items: center; justify-content: center;
        }
        .close-modal:hover {
            background: rgba(255,255,255,0.2); transform: rotate(90deg);
        }
        /* Responsive Tweaks */
        @media (max-width: 768px) {
            .controls { padding: var(--space-18);}
            .button-group { gap: var(--space-10); }
            .btn { padding: var(--space-10) var(--space-10); font-size: var(--font-size-base);}
            .fullscreen-timer { font-size: clamp(60px, 40vw, 180px);}
        }
        @media (max-width: 480px) {
            .container { padding: 0 var(--space-8);}
            .header h1 { font-size: var(--font-size-2xl);}
            .timer-display { font-size: clamp(40px, 14vw, 70px); min-height: 130px;}
            .button-group { flex-direction: column; gap: var(--space-8);}
            .btn { font-size: var(--font-size-sm);}
            .fullscreen-btn, .about-btn { width: 48px; height: 48px; font-size: 19px;}
            .fullscreen-close-btn { width: 60px; height: 60px; font-size: 30px;}
            .fullscreen-timer { font-size: clamp(38px, 28vw, 80px);}
        }
    </style>
</head>
<body class="stage-black">
    <div class="main-scroll-wrapper">
        <button class="fullscreen-btn" id="fullscreenBtn" title="Fullscreen Mode">‚õ∂</button>
        <div class="container" id="mainContainer">
            <div class="header">
                <h1>üé§ Toastmasters Timer</h1>
                <div class="stage-indicator" id="stageIndicator">
                    <span class="stage-dot"></span>
                    <span>Select a Speech</span>
                </div>
            </div>
            <div class="controls">
                <div class="control-group">
                    <label for="speechType">üó£Ô∏è Select Speech Type</label>
                    <select id="speechType">
                        <option value="">-- Choose Speech Type --</option>
                        <option value="prepared">Prepared Speech ‚Äì 5-7 min</option>
                        <option value="icebreaker">Ice Breaker ‚Äì 4-6 min</option>
                        <option value="tabletopics">Table Topics ‚Äì 1-2 min</option>
                        <option value="evaluation">Speech Evaluation ‚Äì 2-3 min</option>
                        <option value="pathways8-10">Extended Pathways ‚Äì 8-10 min</option>
                        <option value="pathways10-12">Extended Pathways ‚Äì 10-12 min</option>
                        <option value="pathways18-22">Extended Pathways ‚Äì 18-22 min</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>‚è±Ô∏è Custom Time</label>
                    <div class="custom-time-inputs">
                        <input type="number" id="customMinutes" placeholder="Minutes" min="0" max="60">
                        <input type="number" id="customSeconds" placeholder="Seconds" min="0" max="59">
                    </div>
                </div>
                <div class="preset-buttons" id="presetButtons"></div>
            </div>
            <div class="timer-display" id="timerDisplay">00:00</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="button-group">
                <button class="btn" id="startBtn">‚ñ∂ START</button>
                <button class="btn" id="pauseBtn" disabled>‚è∏ PAUSE</button>
                <button class="btn" id="resetBtn">üîÑ RESET</button>
            </div>
        </div>
    </div>
    <div class="fullscreen-overlay" id="fullscreenOverlay">
        <button class="fullscreen-close-btn" id="fullscreenCloseBtn">‚úï</button>
        <div class="fullscreen-timer" id="fullscreenTimer">00:00</div>
    </div>
    <button class="about-btn" id="aboutBtn" title="About Developer">?</button>
    <div class="about-modal" id="aboutModal">
        <button class="close-modal" id="closeModal">‚úï</button>
        <h3>üë®‚Äçüíª Developer</h3>
        <p style="font-weight: 700; margin-bottom: var(--space-12); text-align: center;">Rishib More</p>
        <div class="divider"></div>
        <div class="contact-item">
            <span>üìß</span>
            <a href="mailto:rishibmore141@gmail.com">rishibmore141@gmail.com</a>
        </div>
        <div class="contact-item">
            <span>üêô</span>
            <a href="https://github.com/yungrishib" target="_blank">github.com/yungrishib</a>
        </div>
    </div>
    <script>
        const FullscreenAPI = {
            request: (elem) => {
                if (elem.requestFullscreen) return elem.requestFullscreen();
                if (elem.mozRequestFullScreen) return elem.mozRequestFullScreen();
                if (elem.webkitRequestFullscreen) return elem.webkitRequestFullscreen();
                if (elem.msRequestFullscreen) return elem.msRequestFullscreen();
            },
            exit: () => {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
                else if (document.msExitFullscreen) document.msExitFullscreen();
            },
            isActive: () => !!(document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement)
        };

        const state = {
            timeLeft: 0,
            totalTime: 0,
            isRunning: false,
            timerInterval: null,
            stage: 'black',
            isFullscreen: false
        };

        const speeches = {
            prepared: { name: 'Prepared Speech', time: 7 * 60 },
            icebreaker: { name: 'Ice Breaker', time: 6 * 60 },
            tabletopics: { name: 'Table Topics', time: 2 * 60 },
            evaluation: { name: 'Speech Evaluation', time: 3 * 60 },
            'pathways8-10': { name: 'Pathways 8-10', time: 10 * 60 },
            'pathways10-12': { name: 'Pathways 10-12', time: 12 * 60 },
            'pathways18-22': { name: 'Pathways 18-22', time: 22 * 60 }
        };

        const dom = {
            body: document.body,
            container: document.getElementById('mainContainer'),
            timerDisplay: document.getElementById('timerDisplay'),
            progressFill: document.getElementById('progressFill'),
            stageIndicator: document.getElementById('stageIndicator'),
            startBtn: document.getElementById('startBtn'),
            pauseBtn: document.getElementById('pauseBtn'),
            resetBtn: document.getElementById('resetBtn'),
            speechSelect: document.getElementById('speechType'),
            minutesInput: document.getElementById('customMinutes'),
            secondsInput: document.getElementById('customSeconds'),
            presetContainer: document.getElementById('presetButtons'),
            fullscreenBtn: document.getElementById('fullscreenBtn'),
            fullscreenOverlay: document.getElementById('fullscreenOverlay'),
            fullscreenTimer: document.getElementById('fullscreenTimer'),
            fullscreenCloseBtn: document.getElementById('fullscreenCloseBtn'),
            aboutBtn: document.getElementById('aboutBtn'),
            aboutModal: document.getElementById('aboutModal'),
            closeModalBtn: document.getElementById('closeModal')
        };

        function initPresets() {
            dom.presetContainer.innerHTML = '';
            Object.entries(speeches).forEach(([key, data]) => {
                const btn = document.createElement('button');
                btn.className = 'btn--preset';
                btn.textContent = data.name;
                btn.dataset.key = key;
                btn.addEventListener('click', () => selectSpeech(key));
                dom.presetContainer.appendChild(btn);
            });
        }

        function formatTime(secs) {
            const mins = Math.floor(secs / 60);
            const s = secs % 60;
            return `${String(mins).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        function getProgress() {
            return state.totalTime ? ((state.totalTime - state.timeLeft) / state.totalTime) * 100 : 0;
        }

        function updateStage() {
            const prog = getProgress();
            let newStage = 'black';

            if (state.timeLeft === 0 && state.isRunning) {
                newStage = 'complete';
            } else if (prog >= 100) {
                newStage = 'red';
            } else if (prog >= 70) {
                newStage = 'yellow';
            } else if (prog >= 30) {
                newStage = 'green';
            }

            if (newStage !== state.stage) {
                state.stage = newStage;
                dom.body.classList.remove('stage-black', 'stage-green', 'stage-yellow', 'stage-red', 'stage-complete');
                dom.body.classList.add(`stage-${newStage}`);

                const indicators = {
                    black: '<span class="stage-dot"></span><span>Ready to Start</span>',
                    green: '<span class="stage-dot" style="background: #10b981;"></span><span>üü© Green</span>',
                    yellow: '<span class="stage-dot" style="background: #f59e0b;"></span><span>üü® Yellow</span>',
                    red: '<span class="stage-dot" style="background: #ef4444;"></span><span>üü• Red</span>',
                    complete: '<span class="stage-dot" style="background: #ff6b6b; animation: none;"></span><span>‚èπÔ∏è Time Up!</span>'
                };
                dom.stageIndicator.innerHTML = indicators[newStage];

                if (newStage === 'complete') {
                    playSound();
                }
            }
        }

        function playSound() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.value = 800;
                osc.type = 'sine';
                gain.gain.setValueAtTime(0.3, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + 0.5);
            } catch (e) {}
        }

        function updateDisplay() {
            const time = formatTime(state.timeLeft);
            dom.timerDisplay.textContent = time;
            dom.fullscreenTimer.textContent = time;
            dom.progressFill.style.width = getProgress() + '%';
            updateStage();

            if (state.timeLeft <= 3 && state.timeLeft > 0 && state.isRunning) {
                dom.timerDisplay.classList.add('pulse');
            } else {
                dom.timerDisplay.classList.remove('pulse');
            }
        }

        function enterFullscreen() {
            state.isFullscreen = true;
            dom.container.classList.add('hidden');
            dom.fullscreenOverlay.classList.add('active');
            dom.fullscreenBtn.classList.add('hidden');
            dom.fullscreenCloseBtn.classList.add('show');
            dom.aboutBtn.classList.add('hidden');
            FullscreenAPI.request(document.documentElement);
        }

        function exitFullscreen() {
            state.isFullscreen = false;
            dom.container.classList.remove('hidden');
            dom.fullscreenOverlay.classList.remove('active');
            dom.fullscreenBtn.classList.remove('hidden');
            dom.fullscreenCloseBtn.classList.remove('show');
            dom.aboutBtn.classList.remove('hidden');
            if (FullscreenAPI.isActive()) {
                FullscreenAPI.exit();
            }
        }

        function start() {
            if (state.timeLeft === 0) return;
            state.isRunning = true;
            dom.startBtn.disabled = true;
            dom.pauseBtn.disabled = false;
            dom.speechSelect.disabled = true;
            dom.minutesInput.disabled = true;
            dom.secondsInput.disabled = true;

            if (!state.isFullscreen) {
                enterFullscreen();
            }

            state.timerInterval = setInterval(() => {
                if (state.timeLeft > 0) {
                    state.timeLeft--;
                    updateDisplay();
                } else {
                    stop();
                }
            }, 1000);
        }

        function togglePause() {
            if (state.isRunning) {
                clearInterval(state.timerInterval);
                state.isRunning = false;
                dom.pauseBtn.textContent = '‚ñ∂ RESUME';
                dom.startBtn.disabled = false;
            } else {
                state.isRunning = true;
                dom.pauseBtn.textContent = '‚è∏ PAUSE';
                dom.startBtn.disabled = true;

                state.timerInterval = setInterval(() => {
                    if (state.timeLeft > 0) {
                        state.timeLeft--;
                        updateDisplay();
                    } else {
                        stop();
                    }
                }, 1000);
            }
        }

        function stop() {
            clearInterval(state.timerInterval);
            state.isRunning = false;
            dom.startBtn.disabled = false;
            dom.pauseBtn.disabled = true;
            dom.pauseBtn.textContent = '‚è∏ PAUSE';
            dom.speechSelect.disabled = false;
            dom.minutesInput.disabled = false;
            dom.secondsInput.disabled = false;
        }

        function reset() {
            clearInterval(state.timerInterval);
            state.isRunning = false;
            state.timeLeft = state.totalTime;
            dom.startBtn.disabled = false;
            dom.pauseBtn.disabled = true;
            dom.pauseBtn.textContent = '‚è∏ PAUSE';
            dom.speechSelect.disabled = false;
            dom.minutesInput.disabled = false;
            dom.secondsInput.disabled = false;

            dom.body.classList.remove('stage-green', 'stage-yellow', 'stage-red', 'stage-complete');
            dom.body.classList.add('stage-black');
            state.stage = 'black';
            dom.stageIndicator.innerHTML = '<span class="stage-dot"></span><span>Ready to Start</span>';
            dom.progressFill.style.width = '0%';

            exitFullscreen();
            updateDisplay();
        }

        function selectSpeech(key) {
            state.totalTime = speeches[key].time;
            state.timeLeft = speeches[key].time;

            document.querySelectorAll('.btn--preset').forEach(b => {
                b.classList.toggle('active', b.dataset.key === key);
            });

            dom.minutesInput.value = '';
            dom.secondsInput.value = '';
            dom.speechSelect.value = '';

            dom.body.classList.remove('stage-green', 'stage-yellow', 'stage-red', 'stage-complete');
            dom.body.classList.add('stage-black');
            state.stage = 'black';
            dom.stageIndicator.innerHTML = '<span class="stage-dot"></span><span>Ready to Start</span>';
            dom.progressFill.style.width = '0%';

            updateDisplay();
        }

        function setCustomTime() {
            const mins = parseInt(dom.minutesInput.value) || 0;
            const secs = parseInt(dom.secondsInput.value) || 0;
            const total = mins * 60 + secs;
            if (total === 0) return;
            state.totalTime = total; state.timeLeft = total;
            document.querySelectorAll('.btn--preset').forEach(b => b.classList.remove('active'));
            dom.speechSelect.value = '';
            dom.body.classList.remove('stage-green', 'stage-yellow', 'stage-red', 'stage-complete');
            dom.body.classList.add('stage-black');
            state.stage = 'black';
            dom.stageIndicator.innerHTML = '<span class="stage-dot"></span><span>Ready to Start</span>';
            dom.progressFill.style.width = '0%';
            updateDisplay();
        }

        dom.startBtn.addEventListener('click', start);
        dom.pauseBtn.addEventListener('click', togglePause);
        dom.resetBtn.addEventListener('click', reset);
        dom.fullscreenBtn.addEventListener('click', enterFullscreen);
        dom.fullscreenCloseBtn.addEventListener('click', exitFullscreen);
        dom.speechSelect.addEventListener('change', (e) => e.target.value && selectSpeech(e.target.value));
        dom.minutesInput.addEventListener('change', setCustomTime);
        dom.secondsInput.addEventListener('change', setCustomTime);

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && state.isFullscreen) exitFullscreen();
        });

        document.addEventListener('fullscreenchange', () => {
            if (!FullscreenAPI.isActive() && state.isFullscreen) {
                exitFullscreen();
            }
        });

        dom.aboutBtn.addEventListener('click', () => {
            dom.aboutModal.classList.toggle('show');
        });

        dom.closeModalBtn.addEventListener('click', () => {
            dom.aboutModal.classList.remove('show');
        });

        document.addEventListener('click', (e) => {
            if (!dom.aboutBtn.contains(e.target) && !dom.aboutModal.contains(e.target)) {
                dom.aboutModal.classList.remove('show');
            }
        });

        initPresets();
        dom.body.classList.add('stage-black');
        updateDisplay();
    </script>
</body>
</html>
